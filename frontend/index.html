<!DOCTYPE html>
<html>

<head>
  <title>File Listing</title>
  <link rel="stylesheet" href="styles.css">
  <style>
    /* dfdsf */
  </style>
</head>

<body>
  <h2>PDF Organizer</h2>
  <input type="text" id="userId" placeholder="Enter User ID">
  <button id="fetchFiles">Fetch Files</button>
  <button id="uploadTrigger">Upload</button>
  <input type="file" id="uploadFiles" name="filename">
  <div class="files" id="fileList"></div>

  <script>
    const fetchFilesButton = document.getElementById('fetchFiles');
    const uploadFilesButton = document.getElementById('uploadFiles');
    const uploadTriggerButton = document.getElementById('uploadTrigger');
    const userIdInput = document.getElementById('userId');
    const fileListDiv = document.getElementById('fileList');

    fetchFilesButton.addEventListener('click', async () => {
      const userId = userIdInput.value.trim(); // Trim to remove any leading/trailing whitespace

      try {
        const response = await fetch(`http://localhost:3000/uploads/${encodeURIComponent(userId)}`);
        if (!response.ok) throw new Error('Network response was not ok.');

        const filesResponse = await response.json();
        const files = filesResponse.userFiles;

        console.log(files)

        fileListDiv.innerHTML = '';

        if (files.length > 0) {
          const containerDiv = document.createElement('div');
          containerDiv.classList.add('file-list-container');

          files.forEach(filename => {
            const fileDiv = document.createElement('div');
            fileDiv.classList.add('file-item');

            const p = document.createElement('p');
            p.textContent = filename;
            fileDiv.appendChild(p);

            const img = document.createElement('img');
            img.src = `../images/${encodeURIComponent(userId)}/${filename}.1.png`;
            img.alt = `Image of ${filename}`;

            fileDiv.appendChild(img);
            containerDiv.appendChild(fileDiv);
          });

          fileListDiv.appendChild(containerDiv);
        } else {
          fileListDiv.textContent = 'No files found for this user.';
        }
      } catch (error) {
        console.error('Error fetching files:', error);
        fileListDiv.textContent = 'Error fetching files';
      }
    });

    uploadTriggerButton.addEventListener('click', async () => {
      let file = uploadFilesButton.files[0];
      const userId = userIdInput.value.trim();

      if (file) {
        var formData = new FormData();
        formData.append('file', file);

        try {
          const response = await fetch(`http://localhost:3000/upload/${encodeURIComponent(userId)}`, {
            method: 'POST',
            body: formData
          });

          if (response.ok) {
            console.log('File uploaded successfully');
          } else {
            console.error('Error uploading file:', response.statusText);
          }
        } catch (error) {
          console.error('Error uploading file:', error);
        }
      } else {
        console.error('No file selected');
      }
    });
  </script>
</body>

</html>